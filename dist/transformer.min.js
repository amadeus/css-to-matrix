!function(a,b){"object"==typeof exports?module.exports=b(require("transform-to-matrix")):"function"==typeof define&&define.amd?define("transformer",["transform-to-matrix"],b):a.Transformer=b(a["transform-to-matrix"])}(this,function(a){var b=function(a){if("string"==typeof a){var b=parseFloat(a,10),c=a.indexOf("deg")>-1;return c&&(b*=Math.PI/180),b}return a},c=Object.prototype.toString,d=function(a){this.matrix=f.identity(),this.transformations={perspective:f.identity(),rotate:f.identity(),scale:f.identity(),skew:f.identity(),translate:f.identity()},a&&this.setMatrix(a)},e=/(.*matrix[\w]*\(| |\).*)/g;d.prototype={setMatrix:function(a){if("[object Array]"!==c.call(a))throw new TypeError("expected parameter `data` to be an Array, but was given a "+c.call(a));if("[object Array]"!==c.call(a[0]))throw new TypeError("nested array expected.");if(a.length!==a[0].length)throw new Error("parent and child arrays must be the same length");if(a.length>4||a.length<3)throw new Error("must be a 3x3 or 4x4 matrix, was "+a.length+"x"+a[0].length);return 3===a.length&&d.from3x3to4x4(a),this.matrix=d.merge(this.matrix,a),this},setMatrixFromCSS:function(a){var b=d.getMatrixFromCSS(a);return this.setMatrix(b),this},getMatrix:function(){var a=d.clone(this.matrix),b=this.transformations;return a=f.multiply(a,b.perspective),a=f.multiply(a,b.translate),a=f.multiply(a,b.rotate),a=f.multiply(a,b.skew),a=f.multiply(a,b.scale)},getMatrixCSS:function(){return"matrix3d("+f.flip(this.getMatrix()).reduce(function(a,b){return a.push.apply(a,b),a},[]).join(",")+")"},rotate:function(a){return this.rotateZ(a)},rotateX:function(a){return this.rotate3d(1,0,0,a)},rotateY:function(a){return this.rotate3d(0,1,0,a)},rotateZ:function(a){return this.rotate3d(0,0,1,a)},scale:function(a,b){return this.scale3d(a,b)},scaleX:function(a){return this.scale3d(a)},scaleY:function(a){return this.scale3d(null,a)},scaleZ:function(a){return this.scale3d(null,null,a)},skewX:function(a){return this.skew(a)},skewY:function(a){return this.skew(null,a)},translate:function(a,b){return this.translate3d(a,b)},translateX:function(a){return this.translate3d(a)},translateY:function(a){return this.translate3d(null,a)},translateZ:function(a){return this.translate3d(null,null,a)},perspective:function(b){if(b||(b=0),"number"!=typeof b)throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof b);return this.transformations.perspective=f.multiply(this.transformations.perspective,a.perspective(b)),this},rotate3d:function(c,d,e,g){if(c||(c=0),d||(d=0),e||(e=0),g||(g=0),"number"!=typeof c)throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof c);if("number"!=typeof d)throw new TypeError("expected parameter `y` to be a Number, but was given a "+typeof d);if("number"!=typeof e)throw new TypeError("expected parameter `z` to be a Number, but was given a "+typeof e);return this.transformations.rotate=f.multiply(this.transformations.rotate,a.rotate3d(c,d,e,b(g))),this},scale3d:function(b,c,d){if(b||0===b||(b=1),c||0===c||(c=1),d||0===d||(d=1),"number"!=typeof b)throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof b);if("number"!=typeof c)throw new TypeError("expected parameter `y` to be a Number, but was given a "+typeof c);if("number"!=typeof d)throw new TypeError("expected parameter `z` to be a Number, but was given a "+typeof d);return this.transformations.scale=f.multiply(this.transformations.scale,a.scale3d(b,c,d)),this},skew:function(c,d){return c||(c=0),d||(d=0),this.transformations.skew=f.multiply(this.transformations.skew,f.to3d(a.skew(b(c),b(d)))),this},translate3d:function(b,c,e){if(b||(b=0),c||(c=0),e||(e=0),"number"!=typeof b)throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof b);if("number"!=typeof c)throw new TypeError("expected parameter `y` to be a Number, but was given a "+typeof c);if("number"!=typeof e)throw new TypeError("expected parameter `z` to be a Number, but was given a "+typeof e);return d.merge(this.transformations.translate,a.translate3d(b,c,e)),this}};var f={multiply:function(a,b){var c,d,e,f,g,h,i;if(a[0].length!==b.length)throw new Error("Matrix 1's row count should equal matrix 2's column count");for(f=[],h=b.length,c=0;h>c;c++)for(g=b[c],d=0;d<g.length;d++){for(e=h,i=0;e--;)i+=a[c][e]*b[e][d];f.push(i)}for(g=void 0,e=0,c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)a[c][d]=f[e],e++;return f.length=0,a},flip:function(a){var b,c,d,e,f,g;for(d=[],g=a.length,b=0;g>b;b++)for(e=a[b],c=0;g>c;c++)f=e[c],(d[c]||(d[c]=[]))[b]=f;return d},to2d:function(a){return[[a[0][0]||1,a[0][1]||0,a[0][3]||0],[a[1][0]||0,a[1][1]||1,a[1][3]||0]]},to3d:function(a){return[[a[0][0]||1,a[0][1]||0,0,a[0][2]||0],[a[1][0]||0,a[1][1]||1,0,a[1][2]||0],[0,0,1,0],[0,0,0,1]]},identity:function(a){var b,c;if(!a)return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(b=0;b<a.length;b++)for(c=0;c<a[b].length;c++)a[b][c]=b===c?1:0;return a}};return d.Utils=f,d.clone=function(a){var b,c,d=[];for(b=0;b<a.length;b++)for(d[b]=[],c=0;c<a[b].length;c++)d[b][c]=a[b][c]||0;return d},d.merge=function(a,b){var c,d;for(c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)a[c][d]=b[c][d]||0;return a},d.from3x3to4x4=function(a){return a[0].push(0),a[1].push(0),a[2].push(0),a[3]=[0,0,0,1],a},d.getMatrixFromCSS=function(a){var b,c,d,g;if("none"===a||!a)return f.identity();if(a=a.replace(e,""),b=a.split(","),6!==b.length&&16!==b.length)throw new TypeError("invalid array parsed from string: "+a);for(6===b.length&&(b.splice(2,0,0,0),b.splice(6,0,0,0),b.push(1,0,0,0,0,1)),c=[],d=0;d<b.length/4;d++)for(c[d]=[],g=0;4>g;g++)c[d][g]=parseFloat(b[4*d+g]);return c=f.flip(c)},d});