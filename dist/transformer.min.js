!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("transformer",[],b):a.Transformer=b()}(this,function(){var a=function(a){if("string"==typeof a){var b=parseFloat(a,10),c=a.indexOf("deg")>-1;return c&&(b*=Math.PI/180),b}return a},b=function e(a){this.matrix=e.identity(),a&&this.setMatrix(a)},c=/(.*matrix[\w]*\(| |\).*)/g;b.prototype={setMatrix:function(a){return 3===a.length&&b.from3x3to4x4(a),this.matrix=b.merge(this.matrix,a),this},setMatrixFromCSS:function(a){var c=b.getMatrixFromCSS(a);return this.setMatrix(c),this},getMatrixCopy:function(){return b.clone(this.matrix)},getMatrixCSS:function(){return"matrix3d("+b.flip(this.getMatrixCopy()).reduce(function(a,b){return a.push.apply(a,b),a},[]).join(",")+")"},rotate:function(a){return this.rotateZ(a)},rotateX:function(a){return this.rotate3d(1,0,0,a)},rotateY:function(a){return this.rotate3d(0,1,0,a)},rotateZ:function(a){return this.rotate3d(0,0,1,a)},scale:function(a,b){return this.scale3d(a,b)},scaleX:function(a){return this.scale3d(a)},scaleY:function(a){return this.scale3d(null,a)},scaleZ:function(a){return this.scale3d(null,null,a)},skewX:function(a){return this.skew(a)},skewY:function(a){return this.skew(null,a)},translate:function(a,b){return this.translate3d(a,b)},translateX:function(a){return this.translate3d(a)},translateY:function(a){return this.translate3d(null,a)},translateZ:function(a){return this.translate3d(null,null,a)},perspective:function(a){return a||(a=0),b.multiply(this.matrix,d.perspective(a)),this},rotate3d:function(c,e,f,g){return c||(c=0),e||(e=0),f||(f=0),g||(g=0),b.multiply(this.matrix,d.rotate3d(c,e,f,a(g))),this},scale3d:function(a,c,e){return a||0===a||(a=1),c||0===c||(c=1),e||0===e||(e=1),b.multiply(this.matrix,d.scale3d(a,c,e)),this},skew:function(c,e){return c||(c=0),e||(e=0),b.multiply(this.matrix,b.to3d(d.skew(a(c),a(e)))),this},translate3d:function(a,c,e){return a||(a=0),c||(c=0),e||(e=0),b.multiply(this.matrix,d.translate3d(a,c,e)),this}},b.clone=function(a){var b,c,d=[];for(b=0;b<a.length;b++)for(d[b]=[],c=0;c<a[b].length;c++)d[b][c]=a[b][c]||0;return d},b.merge=function(a,b){var c,d;for(c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)a[c][d]=b[c][d]||0;return a},b.from3x3to4x4=function(a){return a[0].push(0),a[1].push(0),a[2].push(0),a[3]=[0,0,0,1],a},b.getMatrixFromCSS=function(a){var d,e,f,g;if("none"===a||!a)return b.identity();for(a=a.replace(c,""),d=a.split(","),6===d.length&&(d.splice(2,0,0,0),d.splice(6,0,0,0),d.push(1,0,0,0,0,1)),e=[],f=0;f<d.length/4;f++)for(e[f]=[],g=0;4>g;g++)e[f][g]=parseFloat(d[4*f+g]);return e=b.flip(e)},b.multiply=function(a,b){var c,d,e,f,g,h,i;for(f=[],h=b.length,c=0;h>c;c++)for(g=b[c],d=0;d<g.length;d++){for(e=h,i=0;e--;)i+=a[c][e]*b[e][d];f.push(i)}for(g=void 0,e=0,c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)a[c][d]=f[e],e++;return f.length=0,a},b.flip=function(a){var b,c,d,e,f,g;for(d=[],g=a.length,b=0;g>b;b++)for(e=a[b],c=0;g>c;c++)f=e[c],(d[c]||(d[c]=[]))[b]=f;return d},b.to2d=function(a){return[[a[0][0]||1,a[0][1]||0,a[0][3]||0],[a[1][0]||0,a[1][1]||1,a[1][3]||0]]},b.to3d=function(a){return[[a[0][0]||1,a[0][1]||0,0,a[0][2]||0],[a[1][0]||0,a[1][1]||1,0,a[1][2]||0],[0,0,1,0],[0,0,0,1]]},b.identity=function(a){var b,c;if(!a)return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(b=0;b<a.length;b++)for(c=0;c<a[b].length;c++)a[b][c]=b===c?1:0;return a};var d={perspective:function(a){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,-1/a,1]]},rotate:function(a){return d.rotateZ(a)},rotateX:function(a){return d.rotate3d(1,0,0,a)},rotateY:function(a){return d.rotate3d(0,1,0,a)},rotateZ:function(a){var b,c;return b=Math.cos(a),c=Math.sin(a),[[b,-c,0],[c,b,0]]},rotate3d:function(a,b,c,d){var e,f,g,h,i;return i=a*a+b*b+c*c,e=Math.cos(d),g=Math.sin(d),f=1-e,h=Math.sqrt(i)*g,[[(a*a+(b*b+c*c)*e)/i,(a*b*f-c*h)/i,(a*c*f+b*h)/i,0],[(a*b*f+c*h)/i,(b*b+(a*a+c*c)*e)/i,(b*c*f-a*h)/i,0],[(a*c*f-b*h)/i,(b*c*f+a*h)/i,(c*c+(a*a+b*b)*e)/i,0],[0,0,0,1]]},scale:function(a,b){return[[a,0,0],[0,b,0]]},scaleX:function(a){return d.scale(a,1)},scaleY:function(a){return d.scale(1,a)},scaleZ:function(a){return d.scale3d(1,1,a)},scale3d:function(a,b,c){return[[a,0,0,0],[0,b,0,0],[0,0,c,0],[0,0,0,1]]},skew:function(a,b){return[[1,Math.tan(a),0],[Math.tan(b),1,0]]},skewX:function(a){return[[1,Math.tan(a),0],[0,1,0]]},skewY:function(a){return[[1,0,0],[Math.tan(a),1,0]]},translate:function(a,b){return[[1,0,a],[0,1,b]]},translateX:function(a){return d.translate(a,0)},translateY:function(a){return d.translate(0,a)},translateZ:function(a){return d.translate3d(0,0,a)},translate3d:function(a,b,c){return[[1,0,0,a],[0,1,0,b],[0,0,1,c],[0,0,0,1]]}};return b});